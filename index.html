<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
  async function main() {
    await liff.init({ liffId: "2008892988-xUkrMmtw" });
    if (!liff.isLoggedIn()) { liff.login(); return; }
    
    const profile = await liff.getProfile();
    const urlParams = new URLSearchParams(window.location.search);
    const act = urlParams.get('act'); // 抓取網址裡的指令
    const scriptURL = "https://script.google.com/macros/s/AKfycbyPDXFmisG6YZJypcbiyA0wJ8QbzZs2yvszA6qiEot23DM96cgTfLdWhyhyTAdrw2P0rg/exec";

    if (act === "m") {
      // 顯示兌換介面
      document.body.innerHTML = `
        <div style="text-align:center; padding-top:50px;">
          <h2>確認兌換？</h2>
          <p>將扣除 10 點點數</p>
          <button onclick="sendData('minus')" style="font-size:20px; background:red; color:white; padding:15px;">確定兌換</button>
        </div>
      `;
    } else {
      // 自動執行加點
      sendData('add');
    }

    window.sendData = function(actionType) {
      fetch(scriptURL, {
        method: 'POST',
        mode: 'no-cors',
        body: JSON.stringify({
          userId: profile.userId,
          displayName: profile.displayName,
          action: actionType
        })
      }).then(() => {
        alert(actionType === 'add' ? "加點成功！" : "兌換完成！");
        liff.closeWindow();
      });
    }
  }
  main();
</script>
